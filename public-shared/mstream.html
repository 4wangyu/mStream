<head>

  <link rel="stylesheet" href="public-shared/css/shared.css">

  <!-- Pure CSS -->
  <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.1/build/pure-min.css" integrity="sha384-CCTZv2q9I9m3UOxRLaJneXrrqKwUNOzZ6NGEUMwHtShDJ+nCoiXJCAgi05KfkLGY" crossorigin="anonymous">

  <!-- Vue JS -->
  <script src="https://unpkg.com/vue/dist/vue.js"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>

  <!-- Sortable-vue -->
  <script src="https://unpkg.com/sortablejs@latest"></script>

  <!--
  This is the mStream Player stack
    DO NOT Change to order these are loaded in
    You do not need to worry about how these works

    TODO: List out all API functions
          -->
  <script src="public-shared/js/aurora.js"></script>
  <script src="public-shared/js/flac.js"></script>
  <script src="public-shared/js/howler.core.min.js"></script>
  <script src="public-shared/js/mstream.js"></script>

  <!-- https://github.com/SortableJS/Vue.Draggable - v2.6 -->
  <script src="public-shared/js/vue-sortable.js"></script>




  <!-- Look at this for an example of how to use the mStream Player -->
  <script>




    // Get token
    // Call server
      // Add songs to playlist

    // Load Song
    function loadSong(){
      MSTREAM.putSong('do%20gs/Dogbreth%20-%20Chookie%2012.40.34%20AM/Dogbreth%20-%20Chookie%20-%2003%20Just%20A%20Kid.mp3');
    }

    function loadSong2(){
      MSTREAM.putSong('do gs/TV Torso - Clear Lake Strangler - 03 No Idea Why.flac?token=x');
    }

    function loadSong3(){
      // MSTREAM.putSong('do gs/TV Torso - Clear Lake Strangler - 03 No Idea Why.flac?token=x');
      MSTREAM.addSong('do%20gs/Dogbreth%20-%20Chookie%2012.40.34%20AM/Dogbreth%20-%20Chookie%20-%2003%20Just%20A%20Kid.mp3');

    }





      window.onload = function() {
        var playStats = MSTREAM.playStatus;

            MSTREAM.addSong('do%20gs/Dogbreth%20-%20Chookie%2012.40.34%20AM/Dogbreth%20-%20Chookie%20-%2003%20Just%20A%20Kid.mp3');
            MSTREAM.addSong('do%20gs/Dogbreth%20-%20Chookie%2012.40.34%20AM/Dogbreth%20-%20Chookie%20-%2003%20Just%20A%20Kid.mp3');
            MSTREAM.addSong('do gs/TV Torso - Clear Lake Strangler - 03 No Idea Why.flac?token=x');


      // TODO: Highlight currently playing song
      Vue.component('playlist-item', {
        template: '\
          <div class="playlist-item" v-bind:class="{ playing: (index2 == active2.val) }" >\
           <span class="song-area">{{ text }}</span> <span class="removeSong">X</div>\
          </div>\
        ',
        props: ['text', 'active', 'index', 'current', 'drag'],
        data: function(){
          return {
            active2: MSTREAM.positionCache,
            index2: this.index,
          }
        }
      });

      var playlistElement = new Vue({
        el: '#playlist',
        data: {
          playlist: MSTREAM.playlist,
          current: MSTREAM.positionCache,
        },
        methods: {
          onUpdate: function (event) {
            this.playlist.splice(event.newIndex, 0, this.playlist.splice(event.oldIndex, 1)[0])
          }
        }

      });




      var playPauseButton = new Vue({
        el: '#play-pause-image',
        data: {
          status: playStats,
          // imgsrc: "public-shared/img/"+(status.p ? 'play' : 'pause')+"-white.svg"
        },
        computed: {
          // a computed getter
          imgsrc: function () {
            // `this` points to the vm instance
            console.log(this.status.playing );
            return "public-shared/img/"+(this.status.playing ? 'pause' : 'play')+"-white.svg";
          }
        }
      });



      console.log('XXXSWEERGERHEWRHRW%GRBTJY%J')
      console.log(MSTREAM.positionCache);


      document.getElementById( "next-button" ).addEventListener("click",function() {
        MSTREAM.nextSong();
      });
      document.getElementById( "play-pause-button" ).addEventListener("click", function() {
        console.log('FUCKKKKKK')
        console.log(MSTREAM.playStatus);
        MSTREAM.playPause();
      });
      document.getElementById("previous-button").addEventListener("click", function(){
        MSTREAM.previousSong();
      });

      console.log(MSTREAM.playlist);



      window.addEventListener("keydown", function(event){
        console.log(playStats);
        console.log(playStats);
        console.log(playStats);
        console.log(playStats);
        console.log(playStats);
        console.log(playStats);





        var element = event.target.tagName.toLowerCase();

        if(element == 'input' || element == 'textarea'){
          return;
        }

        switch (event.keyCode) {
          case 32: //SpaceBar
            MSTREAM.playPause();
            console.log(MSTREAM.playStatus);
            break;
        }
        return false;
      }, false);



    };
  </script>

</head>

<body>


  <div class="header">
    <!-- Test Buttons Go Here -->
    <!-- <button onclick="loadSong()" type="button">Play MP3</button>
    <button onclick="loadSong2()" type="button">Play FLAC!</button>
    <button onclick="loadSong3()" type="button">Play YouTube!</button> -->
  </div>




  <!-- Playlist -->
  <div class="playlist-container">
    <draggable :list="playlist" @start="drag=true" @end="drag=false" id="playlist">
      <div v-for="(song, index) in playlist" is="playlist-item" :key="index" :index="index" :text="song.filepath" :active="(index == current) ? 'theclass' : 'noclass'">
      </div>
    </draggable>
  </div>





  <!-- Controls -->
  <div class="mstream-player">
    <div id="previous-button" class="previous-button">
      <div class="previous-border">
        <img class="previous-image" src="public-shared/img/previous-white.svg">
      </div>
    </div>
    <div id="next-button" class="next-button">
      <div class="next-border">
        <img class="mext-image" src="public-shared/img/next-white.svg">
      </div>
    </div>
    <div id="play-pause-button" class="play-pause-button">
      <div id="play-pause-border"  class="play-pause-border">
        <!-- <img class="play-pause-image" src="public-shared/img/play-white.svg"> -->

        <img id="play-pause-image" class="play-pause-image" :src="imgsrc" >



      </div>
    </div>

    <div class="progress-bar"></div>
  </div>


</body>
