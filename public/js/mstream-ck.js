$(document).ready(function(){function n(e){var t=$(e).attr("id"),n=$(e).data("file_location"),r=$(e).find("span.title").html(),i=$("#currentdir").val(),s=i+t,o="";if($("#playlist li").length==0){o=" current";$("#jquery_jplayer_1").jPlayer("setMedia",{mp3:n})}$("ul#playlist").append($("<li/>",{"data-songurl":n,"class":"dragable"+o,html:'<span class="play1">'+r+'</span><a href="javascript:void(0)" class="closeit">X</a>'}));$("#playlist").sortable()}function r(e){var t=$("#scraper").is(":checked");$.post("dirparser.php",{dir:e,scrape:t},function(e){i(e)})}function i(e){var n=$.parseJSON(e);$("#filelist").empty();var r=[];$.each(n,function(){this.type=="mp3"&&(this.artist!=null||this.title!=null?r.push('<div data-file_location="'+this.link+'" class="filez"><span class="pre-char">&#9836;</span> <span class="title">'+this.artist+" - "+this.title+"</span></div>"):r.push('<div data-file_location="'+this.link+'" class="filez"><span class="pre-char">&#9835;</span> <span class="title">'+this.filename+"</span></div>"));this.type=="dir"&&r.push('<div id="'+this.link+'" class="dirz">'+this.link+"</div>")});$("#currentdir").val()!=t?$(".backButton").prop("disabled",!1):$(".backButton").prop("disabled",!0);$("#filelist").html(r)}var e=$("#jquery_jplayer_1").jPlayer({ready:function(){},swfPath:"jPlayer/jquery.jplayer/Jplayer.swf",supplied:"mp3",smoothPlayBar:!0,keyEnabled:!0}),t=!1;$.getJSON("config/editme.json",function(e){t=e.startdir;$("#currentdir").val(t);r(t);$(".directoryName").html("/");$("#search_container").hide();$(".panel_one_name").html("File Explorer")});$("#search_database").on("click",function(){$(".directoryTitle").hide();$("#search_container").show();$("#filelist").html("");$(".panel_one_name").html("Search")});$("#search_it").on("keyup",function(){if($(this).val().length>1){console.log("32");var e=$.ajax({url:"db_scripts/search_db.php",type:"POST",data:{search:$(this).val()},dataType:"html"});e.done(function(e){$("#filelist").html(e)});e.fail(function(e,t){})}});$("#jquery_jplayer_1").bind($.jPlayer.event.ended,function(e){if($("#playlist").find("li.current").length!=0){var t=$("#playlist").find("li.current");if($("#playlist").find("li.current").next("li").length!=0){var n=$("#playlist").find("li.current").next("li"),r=n.data("songurl");t.toggleClass("current");n.toggleClass("current");$(this).jPlayer("setMedia",{mp3:r});$(this).jPlayer("play")}}});$("#playlist").on("click","li span",function(){var e=$(this).parent().data("songurl");$("#playlist li").removeClass("current");$(this).parent().addClass("current");$("#jquery_jplayer_1").jPlayer("setMedia",{mp3:e});$("#jquery_jplayer_1").jPlayer("play")});$("#clear").click(function(){$("#playlist").empty();$("#playlist_name").val("")});$("#filelist").on("click","div.filez",function(){n(this)});$("#addall").on("click",function(){var e=document.getElementsByClassName("filez"),t=jQuery.makeArray(e);$.each(t,function(){n(this)})});$("body").on("click","a.closeit",function(e){$(this).parent().remove()});$("#download").click(function(){var e=encodeURIComponent($("#currentdir").val());$("#downframe").attr("src","zipdir.php?dir="+e)});$("#downloadPlaylist").click(function(){var e=$("ul#playlist li"),t=jQuery.makeArray(e),n=0;$.each(t,function(){$("<input>").attr({type:"hidden",name:n,value:$(this).data("songurl")}).appendTo("#downform");n++});$("#downform").submit();$("#downform").empty()});$("#file_explorer").on("click",function(){$("#currentdir").val(t);r(t);$(".directoryName").html("/");$(".directoryTitle").hide();$("#directory_bar").show();$(".panel_one_name").html("File Explorer")});$("#filelist").on("click","div.dirz",function(){var e=$(this).attr("id"),n=$("#currentdir").val(),i=n+e+"/";$("#currentdir").val(i);$(".directoryName").html("/"+i.replace(t,""));r(i)});$(".backButton").on("click",function(){if($("#currentdir").val()!=t){var e=$("#currentdir").val(),n=e+"../",i=e.split("/"),s="";for(var o=0;o<i.length-2;o++)s=s+i[o]+"/";$("#currentdir").val(s);$(".directoryName").html("/"+s.replace(t,""));r(n)}});$("#save_playlist_form").on("submit",function(e){e.preventDefault();$("#save_playlist").prop("disabled",!0);var t=$("ul#playlist li"),n=jQuery.makeArray(t),r=$("#playlist_name").val(),i=[];if(/^[a-zA-Z0-9-_ ]*$/.test(r)==0){console.log("do not do that");return!1}$.each(n,function(){i.push($(this).data("songurl"))});$.ajax({type:"POST",url:"savem3u.php",data:{title:r,stuff:i}}).done(function(e){e==1;e==0;$("#save_playlist").prop("disabled",!1);$("#close_save_playlist").trigger("click")})});$("#all_playlists").on("click",function(){$(".directoryTitle").hide();$(".panel_one_name").html("Playlists");$("#filelist").empty();var e=$.ajax({url:"playlists/get_playlists.php",type:"GET"});e.done(function(e){var t=$.parseJSON(e),n=[];$.each(t,function(){n.push('<div data-filename="'+this.file+'" class="playlistz">'+this.file+"</div>")});$("#filelist").html(n)});e.fail(function(e,t){$("#filelist").html("<p>Something went wrong</p>")})});$("#filelist").on("click",".playlistz",function(){var e=$(this).data("filename"),t=$(this).html();$.ajax({type:"POST",url:"playlists/playlist_parser.php",data:{filename:e},dataType:"json"}).done(function(e){$("#playlist_name").val(t);$("#playlist").empty();$.each(e,function(e,t){$("ul#playlist").append($("<li/>",{"data-songurl":t.file,"class":"dragable",html:'<span class="play1">'+t.name+'</span><a href="javascript:void(0)" class="closeit">X</a>'}))});$("#playlist").sortable()})});$("#all_albums").on("click",function(){$(".directoryTitle").hide();var e=$.ajax({url:"db_scripts/find_all_albums.php",type:"GET"});e.done(function(e){var t=$.parseJSON(e);$("#filelist").empty();var n=[];$.each(t,function(){n.push('<div data-album="'+this.album+'" class="albumz">'+this.album+" ["+this.artist+"]</div>")});$("#filelist").html(n);$(".panel_one_name").html("Albums")});e.fail(function(e,t){alert("Request failed: "+t)})});$("#filelist").on("click",".albumz",function(){var e=$(this).data("album"),t=$.ajax({url:"db_scripts/find_all_albums-songs.php",type:"POST",data:{album:e}});t.done(function(e){var t=$.parseJSON(e);console.log(t);$("#filelist").empty();var n=[];$.each(t,function(){this.title==null?n.push('<div data-file_location="'+this.file_location+'" class="filez"><span class="pre-char">&#9836;</span> <span class="title">[MISSING TITLE]</span></div>'):n.push('<div data-file_location="'+this.file_location+'" class="filez"><span class="pre-char">&#9835;</span> <span class="title">'+this.title+"</span></div>")});$("#filelist").html(n)});t.fail(function(e,t){alert("Request failed: "+t)})});$("#filelist").on("click",".artistz",function(){var e=$(this).data("artist"),t=$.ajax({url:"db_scripts/find_all_artists-songs.php",type:"POST",data:{artist:e}});t.done(function(e){var t=$.parseJSON(e);console.log(t);$("#filelist").empty();var n=[];$.each(t,function(){this.title==null?n.push('<div data-file_location="'+this.file_location+'" class="filez"><span class="pre-char">&#9836;</span> <span class="title">[MISSING TITLE]</span></div>'):n.push('<div data-file_location="'+this.file_location+'" class="filez"><span class="pre-char">&#9835;</span> <span class="title">'+this.title+"</span></div>")});$("#filelist").html(n)});t.fail(function(e,t){alert("Request failed: "+t)})});$("#manage_database").on("click",function(){$(".directoryTitle").hide();$(".panel_one_name").html("Database Management");$("#filelist").empty();var e=$.ajax({url:"db_scripts/check_db_status.php",type:"GET",dataType:"json"});e.done(function(e){if(e.error){$("#filelist").html("<p>The database returned the following error:</p><p>"+e.error+"</p>");return}if(e.locked){$("#filelist").html('<p>The database is currently being built</p><input type="button" value="Check Progress" class="button secondary small" id="check_db_progress" >');return}if(e.status=="The database has not been created yet"){$("#filelist").html('<p>The database has not been set up yet. Clicking the button will scan your library and create a database</p><input type="button" class="button secondary small" value="Build Database" id="build_database">');return}$("#filelist").html("<p>Your DB currently stores "+e.file_count+' files</p><input type="button" class="button secondary rounded small" value="Rebuild Database" id="build_database">')})});$("body").on("click","#build_database",function(){$(this).prop("disabled",!0);$.ajax({url:"make_db.php",type:"GET"});$("#filelist").append('<input type="button" value="Check Progress" id="check_db_progress" >')});$("body").on("click","#check_db_progress",function(){var e=$.ajax({url:"db_scripts/db_file_counts.php",type:"GET",dataType:"json"});e.done(function(e){$("#db_progress_report").remove();if(e.file_count==0){$("#filelist").append('<p id="db_progress_report">The create database script is still counting the files in the music collection.  This operation can take some time.  Try again in a bit</p>');return}$("#filelist").append('<p id="db_progress_report">Progress: '+e.files_in_db+"/"+e.file_count+"</p>")})})});