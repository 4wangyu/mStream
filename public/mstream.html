<!doctype html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta content="yes" name="mobile-web-app-capable">
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">

	<link rel="apple-touch-icon" href="/public/img/apple-icon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/public/img/apple-icon/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/public/img/apple-icon/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/public/img/apple-icon/apple-touch-icon-152x152.png">
	<link rel="shortcut icon" sizes="120x120" href="/public/img/apple-icon/apple-touch-icon-120x120.png">
	<link rel="shortcut icon" type="image/png" href="/public/favicon.png"/>

  <title>mStream Media Player - All your media. Everywhere you go.</title>



	<link rel="stylesheet" href="/public/css/foundation.css" />
	<link rel="stylesheet" href="/public/css/master.css">
  <link rel="stylesheet" href="/public/css/radio.css">


  <script src="/public/js/modernizr.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

  <script type="text/javascript" src="/public/js/cookie.js"></script>




    <!-- Vue JS -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- Sortable JS -->
    <script src="https://unpkg.com/sortablejs@latest"></script>
    <!-- https://github.com/SortableJS/Vue.Draggable - v2.6 -->
    <script src="/public/js/vue-sortable.js"></script>

    <link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/8bit-wonder" type="text/css"/>

    <!--
    This is the mStream Player stack
      DO NOT Change to order these are loaded in
      You do not need to worry about how these work
            -->
    <script src="/public/js/aurora.js"></script>
    <script src="/public/js/flac.js"></script>
    <script src="/public/js/howler.core.min.js"></script>
    <script src="/public/js/mstream.player.js"></script>
    <script src="/public/js/mstream.api.js"></script>






  <script type="text/javascript" src="/public/js/mstream.js"></script>






  <!-- Look at this for an example of how to use the mStream Player -->
  <script>
    window.onload = function() {
      // MSTREAMAPI.getSharedPlaylist();
      //
      // MSTREAM.addSong('/Darn Coyotes - See You in Hell- I Guess/Darn Coyotes - See You in Hell, I Guess - 02 We Oughtta Make Like Antelope and Split.mp3');
      // MSTREAM.addSong('/Darn Coyotes - See You in Hell- I Guess/Darn Coyotes - See You in Hell, I Guess - 06 We Are Not the Friends You Are Looking For.mp3');
      // MSTREAM.addSong('/TV Torso - Clear Lake Strangler (1)/TV Torso - Clear Lake Strangler - 02 Prismatic Ideation.flac');
      // MSTREAM.addSong('/Darn Coyotes - See You in Hell- I Guess/Darn Coyotes - See You in Hell, I Guess - 02 We Oughtta Make Like Antelope and Split.mp3');
      // MSTREAM.addSong('/Darn Coyotes - See You in Hell- I Guess/Darn Coyotes - See You in Hell, I Guess - 06 We Are Not the Friends You Are Looking For.mp3');
      // MSTREAM.addSong('/Darn Coyotes - See You in Hell- I Guess/Darn Coyotes - See You in Hell, I Guess - 02 We Oughtta Make Like Antelope and Split.mp3');
      //
      // MSTREAM.addSong('/TV Torso - Clear Lake Strangler (1)/TV Torso - Clear Lake Strangler - 02 Prismatic Ideation.flac');
      // Template for playlist items
      Vue.component('playlist-item', {
        template: '\
          <li class="playlist-item" v-bind:class="{ playing: (this.index == positionCache.val) }" >\
           <span  v-on:click="goToSong($event)" class="song-area">{{ text }}</span> <span v-on:click="removeSong($event)" class="removeSong">X</div>\
          </li>\
        ',

        props: ['text', 'index'],

        // We need the positionCache to track the currently playing song
        data: function(){
          return {
            positionCache: MSTREAM.positionCache,
          }
        },

        // Methods used by playlist item events
        methods: {
          // Go to a song on item click
          goToSong: function(event){
            MSTREAM.goToSongAtPosition(this.index);
          },
          // Remove song
          removeSong: function(event){
            MSTREAM.removeSongAtPosition(this.index, false);
          }
        }
      });

      // Code to update playlist
      var playlistElement = new Vue({
        el: '#playlist',
        data: {
          playlist: MSTREAM.playlist,
        },
        methods: {
          // checkMove is called when a drag-and-drop action happens
          checkMove: function (event) {
            MSTREAM.resetPositionCache();
          }
        }
      });

      // Code to handle Play/Pause images
      var playPauseButton = new Vue({
        el: '#play-pause-image',
        data: {
          status: MSTREAM.playerStats,
        },
        computed: {
          imgsrc: function () {
            return "/public/img/"+(this.status.playing ? 'pause' : 'play')+"-white.svg";
          }
        }
      });


      var progressBar = new Vue({
        el: '#progress-bar',
        data: {
          playerStats: MSTREAM.playerStats,
          playlist: MSTREAM.playlist,
          positionCache: MSTREAM.positionCache

        },
        computed: {
          widthcss: function ( ) {
            if(this.playerStats.duration === 0){
              return "width:0";
            }

            var totalWidth = this.$el.getBoundingClientRect().width;
            var percentage = 100 -  ((  this.playerStats.currentTime / this.playerStats.duration) * 100);

            return "width:calc(100% - "+percentage+"%)";
          },

          showTime: function(){
            if (this.playerStats.duration === 0) {
              return '';
            }

            var curr = this.playerStats.duration - this.playerStats.currentTime;
            var minutes = Math.floor(curr / 60);
            var secondsToCalc = Math.floor(curr % 60) + '';
            var currentText = minutes + ':' + (secondsToCalc.length < 2 ? '0' + secondsToCalc : secondsToCalc);

            return currentText;
          },

          currentSongText: function(){
            if(this.positionCache.val === -1){
              return '\u00A0\u00A0\u00A0Welcome To mStream!\u00A0\u00A0\u00A0';
            }

            var filepathArray = this.playlist[this.positionCache.val].filepath.split("/");

            return '\u00A0\u00A0\u00A0' +  filepathArray[filepathArray.length-1] + '\u00A0\u00A0\u00A0';
          }
        },
        methods: {
          goToPosition: function(event){
            var relativeClickPosition = event.clientX - this.$el.getBoundingClientRect().left;
            var totalWidth = this.$el.getBoundingClientRect().width;
            var percentage = (relativeClickPosition / totalWidth) * 100;
            // Set Player time
            MSTREAM.seekByPercentage(percentage);
          }
        }
      });


      // Button Events
      document.getElementById( "next-button" ).addEventListener("click",function() {
        MSTREAM.nextSong();
      });
      document.getElementById( "play-pause-button" ).addEventListener("click", function() {
        MSTREAM.playPause();
      });
      document.getElementById("previous-button").addEventListener("click", function(){
        MSTREAM.previousSong();
      });


      // This makes the title text scroll back and forth
      var scrollTimer;
      var scrollRight = true; //Track Scroll Direction
      function startTime(interval = 100) {
        if (scrollTimer) { clearInterval(scrollTimer); }

        scrollTimer = setInterval( function(){
          // Get the max scroll distance
          var maxScrollLeft = document.getElementById('title-text').scrollWidth - document.getElementById('title-text').clientWidth;

          // Change the scroll direction if necessary
          // TODO: Pause for a second when these conditions are hit
          if(document.getElementById('title-text').scrollLeft > (maxScrollLeft - 1)){
            scrollRight = false;
          }
          if(document.getElementById('title-text').scrollLeft === 0){
            scrollRight = true;
          }

          // Do the scroll
          if(scrollRight === true){
            document.getElementById('title-text').scrollLeft = document.getElementById('title-text').scrollLeft + 2;
          }else{
            document.getElementById('title-text').scrollLeft = document.getElementById('title-text').scrollLeft - 1;
          }
        }, interval);
      }
      startTime(40);



      // Change spacebar behviour to Play/PauseListen to every key press user makes
        // Useful for adding media functionality to certain keys
      window.addEventListener("keydown", function(event){
        // Use default behavior if user is in a form
        var element = event.target.tagName.toLowerCase();
        if(element == 'input' || element == 'textarea'){
          return;
        }

        // Check the key
        switch (event.keyCode) {
          case 32: //SpaceBar
            event.preventDefault();
            MSTREAM.playPause();
            break;
        }
        return false;
      }, false);
    };
  </script>




</head>

<body>

<!-- Login Screen -->
<div class="login-overlay hide">

    <div class="row">
      <div class="large-3 medium-3 small-1 columns"><p></p></div><!-- Empty <p> tag is necessary so the div doesn't get compressed into a smaller space -->

      <div class="large-6 medium-6 small-10 columns">
        <object class="login-icon" type="image/svg+xml" data="/public/img/mstream-icon.svg">
          Your browser does not support SVG
        </object>
        <form id="login-form" method="post">
            <div class="form-group">
                <label>Username</label>
                <input type="text" class="form-control" id="login-username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input required type="password" class="form-control" id="login-password">
            </div>

            <button id="login-submit" type="submit" class="btn btn-warning btn-lg">Login</button>
        </form>

        <div id="login-alert" class="super-hide alert-box alert">Login Failed</div>
      </div>

      <div class="large-3 medium-3 small-1 columns"><p></p></div>


  </div>
</div>



<!-- Size Classes: [small medium large xlarge expand] -->
<div id="savePlaylist" class="reveal-modal small" data-reveal>
  <h2>Save Playlist</h2>
  	<form id="save_playlist_form">
	  <input id="playlist_name" type="text" required placeholder="Enter your playlist name" pattern="[a-zA-Z0-9 _-]+">
	  <input id="save_playlist" type="submit" class="button small" value="Save Playlist">
	</form>
  <a id="close_save_playlist" class="close-reveal-modal">&#215;</a>
</div>


	<!-- Download iFrame -->
	<form id="downform" action="download" target="frameframe" method="POST"></form>

	<iframe id="downframe" src="" width="0" height="0" tabindex="-1" title="empty" class="hidden" hidden name="frameframe"></iframe>

<div class="off-canvas-wrap">
  <div class="inner-wrap">
    <nav class="tab-bar">

      <section class="left-small">
        <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
      </section>

      <section class="right tab-bar-section">
      	<h1 class="title"><img src="/public/img/mstream-logo.png" class="logo" alt="MStream" width="181" height="auto"></h1>

        <div class="radio-group hide-for-small">
          <input class="get_file_explorer" type="radio" id="radio1" name="radios" value="all" checked>
             <label for="radio1">Files</label>
          <input class="get_all_playlists" type="radio" id="radio2" name="radios"value="false">
             <label for="radio2">Playlists</label>
          <input class="get_all_artists" type="radio" id="radio3" name="radios" value="true">
             <label for="radio3">Artists</label>
           <input class="get_all_albums" type="radio" id="radio4" name="radios" value="true">
              <label for="radio4">Albums</label>
         </div>
      </section>

    </nav>

<!-- Off Canvas Menu -->
    <aside class="left-off-canvas-menu">
      <ul class="off-canvas-list" id="playlist_list">
				<li class="left-off-canvas-toggle get_file_explorer show-for-small-only" class="get_file_explorer" id="file_explorer"><label>File Explorer</label></li>
				<li class="left-off-canvas-toggle get_all_playlists show-for-small-only" id="all_playlists"><label>Playlists</label></li>
				<li class="left-off-canvas-toggle get_all_albums show-for-small-only"  id="all_albums"><label>Albums</label></li>
				<li class="left-off-canvas-toggle get_all_artists show-for-small-only" id="all_artists"><label>Artists</label></li>

				<li class="left-off-canvas-toggle" id="manage_database"><label>Database</label></li>
				<li class="left-off-canvas-toggle" id="search_database"><label>Search</label></li>
      </ul>
    </aside>

    <section class="main-section">
      <!-- content goes in here -->
		<div class="row ohidden">

		<dl class="tabs show-for-small-only" data-tab>
		  <dd class="active"><a class="panel_one_name" href="#panel1">Library</a></dd>
		  <dd><a href="#panel2">Now Playing</a></dd>
		</dl>


		<div class="tabs-content">
		  <div class="content active" id="panel1">
			<div class="large-12 columns libraryColumn">
				<div class="columnHeader">

					<div class="libraryHeaderContainer">
						<div class="large-6 medium-6 small-12 columns noPaddingLeft">
							<h3 class="panel_one_name hide-for-small">Library</h3>
						</div>

						<div class="large-6 medium-6 small-12 columns">
							<div class="controls leftControls">
								<a title="Add Directory to Playlist" class="add" id='addall'><img src="/public/img/glyphicons/png/glyphicons_131_inbox_plus.png" alt="" width="27" height="27"></a><!-- Add Directory to Playlist -->
								<!-- <a title="Download Directory" class="downloadDirectory" id='download'><img src="/public/img/glyphicons/png/glyphicons_181_download_alt.png" alt="" width="27" height="27"></a> --><!-- Download Directory -->
 								<!-- <div class="scraper">
									<label for="scraper" id="getInfo" class="scrape">Get track info</label>
									<input class="left" type="checkbox" id="scraper">
								</div> -->
							</div>
						</div>
					</div><!-- /libraryHeaderContainer -->
          <div class="clear flatline"></div>
					<div id="directory_bar" class="clear directoryTitle">
						<button class="backButton tiny"><img src="/public/img/glyphicons/png/glyphicons_435_undo.png" alt="Back" width="15" height="15"></button>
						<h4 class="directoryName"></h4> <!-- Current Directory -->
            <input id="search_folders" class="hide" >
            <a title="Search" id="search-explorer" ><img src="/public/img/glyphicons/search.png" alt="" width="27" height="27"></a>

					</div>

					<div id="search_container" class="clear directoryTitle">
						<input type="search" placeholder="Search here" class="search_db" id="search_it">
					</div>

				</div>
				<div class='clear col scroll' id='filelist'>
					<div class="filez">Nothing Here...</div>
				</div>
			</div><!-- /6 columns -->		  </div>
		  <div class="content" id="panel2">
			<div class="large-12 columns playlistColumn" id="playlist_container" >
				<div class="columnHeader">
					<div class="large-6 medium-6 small-12 columns noPaddingLeft">
						<h3 class="hide-for-small">Now Playing</h3>
					</div>

					<div class="large-6 medium-6 small-12 columns">
						<div class="controls">
              <a title="Clear Playlist" class="clear" id='clear'><img src="/public/img/glyphicons/png/glyphicons_192_circle_remove.png" alt="" width="27" height="27"></a><!-- Clear Playlist -->
							<a title="Download Playlist" class="downloadPlaylist" id="downloadPlaylist"><img src="/public/img/glyphicons/png/glyphicons_181_download_alt.png" width="27" height="27"></a> <!-- Download Playlist -->
							<a title="Save Playlist" class="save" data-reveal-id="savePlaylist" ><img src="/public/img/glyphicons/png/glyphicons_443_floppy_disk.png" alt="" width="27" height="27"></a><!-- Save Playlist -->
						</div>
					</div>
				</div>

        <div class="clear flatline" ></div>

				<div class="clear col scroll scrollBoxHeight2">
					<ul class="clear" >
            <draggable :list="playlist" @end="checkMove"  id="playlist">
              <li v-for="(song, index) in playlist" is="playlist-item" :key="index" :index="index" :text="song.filepath" >
              </li>
            </draggable>
          </ul>


				</div>
			</div><!--/6 cols-->
		  </div>
		</div>




		</div>
		<!-- /row -->


			<div class="jplay col">
				<div class ="row">
					<div id="jp_container_1" class="jp-audio">

            <div class="mstream-player">
              <div id="previous-button" class="previous-button">
                <div class="previous-border">
                  <img class="previous-image" src="/public/img/previous-white.svg">
                </div>
              </div>

              <div id="play-pause-button" class="play-pause-button">
                <div id="play-pause-border"  class="play-pause-border">
                  <img id="play-pause-image" class="play-pause-image" :src="imgsrc" >
                </div>
              </div>

              <div id="next-button" class="next-button">
                <div class="next-border">
                  <img class="mext-image" src="/public/img/next-white.svg">
                </div>
              </div>

              <div v-on:click="goToPosition($event)" id="progress-bar" class="progress-bar">
                <div class="titlebar" >
                  <div id="title-text" class="title-text">{{currentSongText}}</div>
                  <div class="duration-text">{{showTime}}</div>
                </div>
                <div class="pbar" :style="widthcss"></div>
              </div>
            </div>
            
					</div>
        </div>
			</div>

      <!-- <div class="row">
        <div class="jplayX">
        </div>
      </div> -->


		</div>

	</div><!-- /6 columns -->


    </section>




  <!-- close the off-canvas menu -->
  <a class="exit-off-canvas"></a>

  </div>
</div>

    <script src="/public/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>

</body>
